<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Queue Wizard</title>
  <link rel="stylesheet" href="styles/podcasts.css?v=20260213-1" />
  <link rel="stylesheet" href="styles/podcasts2.css?v=20260209-2" />
  <style>
    body{background:#0c1526;color:#e7eefc;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    .wrap{max-width:1080px;margin:0 auto;padding:18px}
    .card{background:#101c33;border:1px solid #2a3a58;border-radius:18px;padding:12px;margin:10px 0}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end}
    .pickGrid{display:grid;grid-template-columns:repeat(4,minmax(180px,1fr));gap:10px}
    .pickGrid label{display:block}
    .pickGrid select{width:100%;min-width:0}
    .actionBar{display:flex;flex-direction:column;gap:10px;align-items:stretch;padding:10px;border:1px solid #2a3a58;border-radius:10px;background:#0d182d;margin-top:10px}
    .choiceLine{display:flex;flex-wrap:wrap;gap:14px;align-items:center}
    .choiceGroup{display:flex;gap:10px;align-items:center}
    .btnPrimary{background:#1f6feb;border-color:#356fb6;font-weight:600}
    .hidden{display:none !important}
    select,input,button{padding:8px 10px;border-radius:8px;border:1px solid #334;background:#0a1222;color:#eef}
    select.starFilter{color:#fbbf24;font-weight:600}
    button{cursor:pointer;background:#17324f}
    table{width:100%;border-collapse:collapse;font-size:12px}
    th,td{padding:6px;border-bottom:1px solid #22314d;text-align:left}
    tr.dragging{opacity:1 !important}
    tr.drop-before td{border-top:3px solid #22d3ee !important}
    tr.drop-after td{border-bottom:3px solid #22d3ee !important}
    .muted{color:#9fb1d9;font-size:12px}
    #podcastSection .pickGrid input,
    #podcastSection .pickGrid select{min-height:40px;box-sizing:border-box}
    /* Filter Builder control parity */
    #maxTracks,
    #minRating{
      height:44px;
      min-height:44px;
      max-height:44px;
      border-radius:14px;
      box-sizing:border-box;
      padding:6px 10px;
    }
    /* Safari/native-control parity: force these 4 controls to same rendered size */
    #podcastShows,
    #podcastDateFrom,
    #podcastDateTo,
    #podcastMaxPerShow{
      height:44px !important;
      min-height:44px !important;
      max-height:44px !important;
      box-sizing:border-box;
      padding:6px 10px;
      line-height:1.2;
      width:100%;
      border-radius:14px !important;
    }
    #podcastDateFrom,
    #podcastDateTo{
      -webkit-appearance:none;
      appearance:none;
    }
    .warn{color:#ffd28a}
    .spin{display:inline-block;width:12px;height:12px;border:2px solid rgba(255,255,255,.28);border-top-color:#9fd2ff;border-radius:50%;animation:spin .8s linear infinite;vertical-align:-2px;margin-right:6px}
    @media (max-width:900px){.pickGrid{grid-template-columns:1fr}}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>

<body>
  <div class="heroRail">
    <div class="heroWrap">
      <div style="display:flex;gap:10px;justify-content:space-between;align-items:flex-end;flex-wrap:wrap;">
        <nav class="topTabs" aria-label="Main pages" style="margin-bottom:0;">
          <a href="config.html">Config</a>
          <a href="diagnostics.html">Diagnostics</a>
          <a href="library-health.html">Library Health</a>
          <a href="queue-wizard.html" class="active">Queue Wizard</a>
          <a href="podcasts.html" id="podcastsNavLink">Podcasts</a>
        </nav>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <div class="pill" id="apiPill" title="Active API endpoint">
            <span class="dot" aria-hidden="true"></span>
            API: <span id="apiHint" style="color:rgba(255,255,255,.9)">loading…</span>
          </div>
          <div class="pill" id="webPill" title="Active web UI endpoint">
            <span class="dot" aria-hidden="true"></span>
            Web: <span id="webHint" style="color:rgba(255,255,255,.9)">loading…</span>
          </div>
          <div class="pill" id="alexaPill" title="Alexa public domain health">
            <span class="dot" aria-hidden="true"></span>
            Alexa: <span id="alexaHint" style="color:rgba(255,255,255,.9)">unknown</span>
          </div>
          <div class="pill" id="moodePill" title="moOde host verification">
            <span class="dot" aria-hidden="true"></span>
            moOde: <span id="moodeHint" style="color:rgba(255,255,255,.9)">unknown</span>
          </div>
        </div>
      </div>
      <header>
        <div class="brand">
          <h1>Queue Wizard</h1>
          <div class="sub">Build from filters, vibe, or playlists • Preview, reorder, send</div>
        </div>
      </header>
    </div>
  </div>

  <div class="wrap">
    <input id="apiBase" type="hidden" />
    <input id="key" type="hidden" />

    <div class="card" id="existingSection" style="overflow:visible;position:relative;z-index:25;">
      <h3 style="margin:0 0 8px">Playlists Queue Builder</h3>
      <div class="muted" style="margin-top:4px">Choose an existing playlist to load.</div>
      <div id="existingPlaylistWrap" style="margin-top:10px;min-width:320px;max-width:620px;display:flex;flex-direction:column;align-items:flex-start;overflow:visible;position:relative;">
        <label for="existingPlaylists" style="display:block;text-align:left;width:100%;max-width:460px;">Existing playlists</label>
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-start;width:100%;max-width:460px;position:relative;">
          <select id="existingPlaylists" style="display:none;"></select>
          <div id="existingPlaylistPicker" style="flex:1 1 320px;min-width:260px;max-width:390px;position:relative;overflow:visible;">
            <button id="existingPlaylistToggle" type="button" style="width:100%;text-align:left;display:flex;justify-content:space-between;align-items:center;gap:8px;">
              <span id="existingPlaylistLabel">(select existing playlist)</span>
              <span aria-hidden="true">▾</span>
            </button>
            <div id="existingPlaylistMenu" style="display:none;position:absolute;z-index:200;left:0;right:-48px;top:calc(100% + 6px);background:#0f1a30;border:1px solid #334;border-radius:12px;max-height:320px;overflow:auto;padding:8px;box-shadow:0 10px 24px rgba(0,0,0,.35);"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="card" id="filterSection">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap;">
        <div>
          <h3 style="margin:0 0 8px">Filter Queue Builder</h3>
          <div class="muted" style="margin-top:4px">Pick genres/artists and exclusions, preview matches, then send that filtered list.</div>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <label>Max tracks<br><input id="maxTracks" type="number" min="1" max="5000" value="25" style="width:100px"></label>
        <label>At least rating<br>
          <select id="minRating" class="starFilter" style="width:140px">
            <option value="0">Any</option>
            <option value="1">★☆☆☆☆</option>
            <option value="2" selected>★★☆☆☆</option>
            <option value="3">★★★☆☆</option>
            <option value="4">★★★★☆</option>
            <option value="5">★★★★★</option>
          </select>
        </label>
      </div>
      <div class="pickGrid" style="margin-top:10px">
        <label>Genres<br><select id="genres" multiple size="8"></select></label>
        <label>Artists<br><select id="artists" multiple size="8"></select></label>
        <label>Albums<br><select id="albums" multiple size="8"></select></label>
        <label>Exclude Genres<br><select id="excludeGenres" multiple size="8"></select></label>
      </div>

      <div class="actionBar">
        <div class="choiceLine">
          <label><input type="radio" name="mode" value="replace" checked> Replace Queue</label>
          <label><input type="radio" name="mode" value="append"> Add to Queue</label>
          <label><input id="crop" type="checkbox" checked> Crop Queue</label>
          <label><input id="shuffle" type="checkbox"> Shuffle</label>
        </div>

        <div class="choiceLine">
          <button id="sendFilteredToMoode" class="btnPrimary">Send queue to moOde</button>
        </div>
      </div>
    </div>

    <div class="card" id="vibeSection">
      <h3 style="margin:0 0 8px">Vibe Queue Builder</h3>
      <div class="muted">Uses the currently playing track as a seed and discovers similar tracks live.</div>

      <div class="actionBar" style="margin-top:10px">
        <div class="choiceLine">
          <label><input type="radio" name="modeVibe" value="replace" checked> Replace Queue</label>
          <label><input type="radio" name="modeVibe" value="append"> Add to Queue</label>
          <label><input id="cropVibe" type="checkbox" checked> Crop Queue</label>
          <label>At least rating
            <select id="minRatingVibe" class="starFilter" style="width:140px;margin-left:6px">
              <option value="0">Any</option>
              <option value="1">★☆☆☆☆</option>
              <option value="2" selected>★★☆☆☆</option>
              <option value="3">★★★☆☆</option>
              <option value="4">★★★★☆</option>
              <option value="5">★★★★★</option>
            </select>
          </label>
        </div>

        <div class="choiceLine" style="margin-top:4px">
          <button id="vibeBuild" class="btnPrimary">Build vibe queue from now playing</button>
          <button id="sendVibeToMoode" class="btnPrimary">Send vibe queue to moOde</button>
        </div>
      </div>

      <div id="vibeProgressWrap" class="hidden" style="margin-top:10px;">
        <div id="vibeProgressText" style="margin-bottom:6px;"></div>
        <progress id="vibeProgressBar" value="0" max="100" style="width:100%; height:16px;"></progress>
        <div id="vibeProgressDetail" style="margin-top:6px; opacity:0.9;"></div>
        <button id="vibeCancel" type="button" class="hidden" style="margin-top:10px;">Cancel</button>
      </div>
    </div>
    <div id="vibeDisabledNote" class="card muted warn hidden">Vibe is disabled. Add a Last.fm API key in Config to enable it.</div>

    <div class="card" id="podcastSection">
      <h3 style="margin:0 0 8px">Podcast Queue Builder</h3>
      <div class="muted">Build a queue from podcast episodes by show/date, then send to moOde.</div>

      <div class="pickGrid" style="margin-top:10px;grid-template-columns: 1.4fr .8fr .8fr .8fr;">
        <label>Shows<br><select id="podcastShows" multiple size="8"></select></label>
        <label>From date<br><input id="podcastDateFrom" type="date" /></label>
        <label>To date<br><input id="podcastDateTo" type="date" /></label>
        <label>Max eps/show<br><input id="podcastMaxPerShow" type="number" min="1" max="100" value="10" style="width:120px" /></label>
      </div>

      <div class="actionBar" style="margin-top:10px">
        <div class="choiceLine">
          <label><input type="radio" name="modePodcast" value="replace" checked> Replace Queue</label>
          <label><input type="radio" name="modePodcast" value="append"> Add to Queue</label>
          <label><input id="cropPodcast" type="checkbox" checked> Crop Queue</label>
        </div>
        <div class="choiceLine" style="margin-top:4px">
          <label><input id="podcastDownloadedOnly" type="checkbox" checked /> Downloaded only</label>
          <label><input id="podcastNewestFirst" type="checkbox" checked /> Newest first</label>
        </div>
        <div class="choiceLine" style="margin-top:4px">
          <span class="muted">Presets:</span>
          <button id="podcastPreset24h" type="button">Last 24h</button>
          <button id="podcastPreset48h" type="button">Last 48h</button>
          <button id="podcastPreset7d" type="button">Last 7 days</button>
        </div>
        <div class="choiceLine" style="margin-top:4px">
          <button id="sendPodcastToMoode" class="btnPrimary">Send podcast queue to moOde</button>
        </div>
      </div>
    </div>

    <div class="muted" id="status" style="margin-top:6px"></div>
    <div class="muted" id="sendConfirm" style="margin-top:4px;color:#9ef7b2;"></div>

    <div class="card">
      <div style="display:flex;gap:14px;align-items:flex-start;flex-wrap:wrap;">
        <div id="coverCard" style="display:none;min-width:160px;max-width:220px;">
          <div class="muted" id="coverStatus">Playlist cover preview</div>
          <img id="coverPreview" alt="Playlist cover preview"
               style="margin-top:8px;width:220px;max-width:100%;aspect-ratio:1/1;object-fit:cover;border:1px solid #334;border-radius:16px;background:#0a1222;" />
        </div>
        <div style="flex:1 1 380px;min-width:280px;">
          <div class="muted" id="count">No list yet.</div>
          <div class="muted" id="filtersSummary" style="margin-top:4px"></div>
          <div class="muted" id="playlistSuggestion" style="margin-top:8px;display:none;"></div>
          <div class="choiceGroup" style="margin-top:8px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
            <button id="savePlaylistBtn" type="button" class="btnPrimary">Save Queue to Playlist</button>
          </div>
          <div id="playlistOptions" class="hidden" style="margin-top:8px;display:flex;gap:12px;align-items:flex-end;flex-wrap:wrap;">
            <div id="playlistNameWrap">
              <label>Playlist name<br><input id="playlistName" placeholder="e.g., Chill Evening Mix"></label>
            </div>
            <button id="savePlaylistNowBtn" type="button" class="btnPrimary" style="align-self:flex-end;">Save Playlist + Cover to moOde</button>
          </div>
          <div class="muted warn" id="playlistHint" style="margin-top:6px"></div>
        </div>
      </div>
      <div id="results" style="margin-top:10px;"></div>
      <div id="playlistThumbStrip" style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;"></div>
    </div>
  </div>

  <script src="scripts/queue-wizard.js?v=20260216-42"></script>

<script>
(async function syncPodcastsNavVisibility(){
  try {
    const link = document.getElementById('podcastsNavLink');
    if (!link) return;
    const apiPort = (location.port === '8101') ? '3101' : '3000';
    const apiBase = `${location.protocol}//${location.hostname}:${apiPort}`;
    const r = await fetch(`${apiBase}/config/runtime`, { cache: 'no-store' });
    const j = await r.json().catch(() => ({}));
    const enabled = !!(r.ok && j?.ok && j?.config?.features?.podcasts);
    if (!enabled) link.style.display = 'none';
  } catch (_) {}
})();
</script>
</body>
</html>
